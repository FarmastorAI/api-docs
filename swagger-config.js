let currentSwaggerUI = null;

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð¼
document.addEventListener('DOMContentLoaded', function() {
    loadSwagger('services/user-service.yaml');
});

function loadSwagger(specUrl) {
    // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€
    if (currentSwaggerUI) {
        const swaggerContainer = document.getElementById('swagger-ui');
        swaggerContainer.innerHTML = '';
    }
    
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Swagger UI
    currentSwaggerUI = SwaggerUIBundle({
        url: specUrl,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
            SwaggerUIBundle.presets.apis,
            SwaggerUIBundle.presets.standalone
        ],
        plugins: [
            SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout",
        tryItOutEnabled: true,
        requestInterceptor: (request) => {
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
            request.headers['Authorization'] = 'Bearer YOUR_TOKEN_HERE';
            return request;
        },
        responseInterceptor: (response) => {
            console.log('API Response:', response);
            return response;
        }
    });
    
    // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð°ÐºÑ‚Ð¸Ð²Ð½ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ
    document.querySelectorAll('.service-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
}

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐµÑ€Ð²Ð¸ÑÐ° Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸
function addNewService(name, specUrl, icon = 'ðŸ”§') {
    const buttonsContainer = document.querySelector('.service-buttons');
    const newButton = document.createElement('button');
    newButton.className = 'service-btn';
    newButton.innerHTML = `${icon} ${name}`;
    newButton.onclick = () => loadSwagger(specUrl);
    buttonsContainer.appendChild(newButton);
}
